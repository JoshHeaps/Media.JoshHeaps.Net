@page
@model Media.JoshHeaps.Net.Pages.IndexModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "_Layout";
}

@section Styles {
    <link rel="stylesheet" href="~/css/Home/page.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/gallery.css" asp-append-version="true" />
}

<div class="dashboard-container">
    <div class="welcome-section">
        <h1>Welcome back, @Model.Dashboard?.Username!</h1>
        <p>Here's your account overview</p>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h2>Account Information</h2>
            <div class="info-row">
                <span class="info-label">Username:</span>
                <span class="info-value">@Model.Dashboard?.Username</span>
            </div>
            <div class="info-row">
                <span class="info-label">Email:</span>
                <span class="info-value">@Model.Dashboard?.Email</span>
            </div>
            <div class="info-row">
                <span class="info-label">Email Status:</span>
                <span class="info-value">
                    @if (Model.Dashboard?.EmailVerified == true)
                    {
                        <span class="status-badge status-verified">✓ Verified</span>
                    }
                    else
                    {
                        <span class="status-badge status-unverified">⚠ Not Verified</span>
                    }
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">Member Since:</span>
                <span class="info-value">@Model.Dashboard?.CreatedAt.ToString("MMMM d, yyyy")</span>
            </div>
            @if (Model.Dashboard?.LastLogin != null)
            {
                <div class="info-row">
                    <span class="info-label">Last Login:</span>
                    <span class="info-value">@Model.Dashboard.LastLogin.Value.ToString("MMMM d, yyyy h:mm tt")</span>
                </div>
            }
        </div>

        <div class="card">
            <h2>Profile Details</h2>
            @if (!string.IsNullOrEmpty(Model.Dashboard?.Profile?.Bio))
            {
                <div class="info-row">
                    <span class="info-label">Bio:</span>
                    <span class="info-value">@Model.Dashboard.Profile.Bio</span>
                </div>
            }
            @if (!string.IsNullOrEmpty(Model.Dashboard?.Profile?.Location))
            {
                <div class="info-row">
                    <span class="info-label">Location:</span>
                    <span class="info-value">@Model.Dashboard.Profile.Location</span>
                </div>
            }
            @if (!string.IsNullOrEmpty(Model.Dashboard?.Profile?.Website))
            {
                <div class="info-row">
                    <span class="info-label">Website:</span>
                    <span class="info-value">
                        <a href="@Model.Dashboard.Profile.Website" target="_blank" style="color: #667eea;">
                            @Model.Dashboard.Profile.Website
                        </a>
                    </span>
                </div>
            }
            @if (string.IsNullOrEmpty(Model.Dashboard?.Profile?.Bio) &&
                 string.IsNullOrEmpty(Model.Dashboard?.Profile?.Location) &&
                 string.IsNullOrEmpty(Model.Dashboard?.Profile?.Website))
            {
                <div class="empty-state">
                    No profile information yet
                </div>
            }
        </div>
    </div>

    <div class="card">
        <h2>Quick Actions</h2>
        <div class="quick-actions">
            @if (Model.Dashboard?.EmailVerified == false)
            {
                <a href="/ResendVerification?email=@Uri.EscapeDataString(Model.Dashboard.Email)" class="btn btn-primary">
                    Verify Email
                </a>
            }
            <a href="/Logout" class="btn btn-danger">Logout</a>
        </div>
    </div>

    <div class="card">
        <h2>Upload Image</h2>
        @if (!string.IsNullOrEmpty(Model.UploadMessage))
        {
            <div class="alert @(Model.UploadSuccess ? "alert-success" : "alert-error")">
                @Model.UploadMessage
            </div>
        }
        <form method="post" enctype="multipart/form-data">
            @Html.AntiForgeryToken()
            <div class="form-group">
                <label for="UploadedFile">Select Image</label>
                <input type="file" id="UploadedFile" name="UploadedFile" accept="image/*" required />
            </div>
            <div class="form-group">
                <label for="Description">Description (optional)</label>
                <textarea id="Description" name="Description" rows="3" placeholder="Add a description..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
        </form>
    </div>

    <div class="card">
        <h2>My Images (@Model.MediaItems.Count)</h2>
        <div id="gallery" class="gallery-grid">
            @foreach (var media in Model.MediaItems)
            {
                <div class="gallery-item" data-media-id="@media.Id">
                    <img src="/api/media/image/@media.Id" alt="@media.FileName" loading="lazy" />
                    @if (!string.IsNullOrEmpty(media.Description))
                    {
                        <div class="gallery-item-description">@media.Description</div>
                    }
                    <div class="gallery-item-info">
                        <span class="gallery-item-date">@media.CreatedAt.ToString("MMM d, yyyy")</span>
                        <form method="post" asp-page-handler="Delete" style="display:inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="mediaId" value="@media.Id" />
                            <button type="submit" class="btn-delete" onclick="return confirm('Are you sure you want to delete this image?');">Delete</button>
                        </form>
                    </div>
                </div>
            }
        </div>
        <div id="loading" style="display:none; text-align:center; padding:20px;">
            Loading more images...
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/gallery.js" asp-append-version="true"></script>
}